{% extends 'base.html' %}

{% block title %}
history_analysis page
{% endblock %}

{% block content %}
<!-- 引入 Bootstrap 的樣式 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

<body>
    <div class="sticky-top bg-white p-3 shadow-sm">
        <h1 class="text-success">封包資料</h1>
    </div>

    <div class="container mt-4">
        <table class="table table-bordered table-hover">
            <thead class="table-success">
                <tr>
                    <th>時間</th>
                    <th>來源 IP</th>
                    <th>目的 IP</th>
                    <th>協議</th>
                    <th>長度</th>
                    <th>來源端口</th>
                    <th>目的端口</th>
                </tr>
            </thead>
            <tbody id="packet-table">
                <!-- 資料將在這裡填充 -->
            </tbody>
        </table>
    </div>

    <script>
        async function fetchData() {
            const response = await fetch('/history_analysis/packet_data');
            const data = await response.json();
            const tableBody = document.querySelector('#packet-table');
            tableBody.innerHTML = ''; // 清空表格
            data.forEach(packet => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${packet.timestamp}</td>
                    <td>${packet.src_ip}</td>
                    <td>${packet.dst_ip}</td>
                    <td>${packet.protocol}</td>
                    <td>${packet.length}</td>
                    <td>${packet.src_port}</td>
                    <td>${packet.dst_port}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        setInterval(fetchData, 2000); // 每2秒刷新一次資料
        fetchData(); // 頁面載入時先取一次資料
    </script>
</body>

{% endblock %}
